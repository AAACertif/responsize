var d=this;function f(a,b){var c=a.split("."),e=d;c[0]in e||!e.execScript||e.execScript("var "+c[0]);for(var h;c.length&&(h=c.shift());)c.length||void 0===b?e=e[h]?e[h]:e[h]={}:e[h]=b};function g(){this.I=window.ce.api.CloudExplorer.get("ce-js")}f("FileService",g);g.prototype.open=function(){var a=this;return new Promise(function(b,c){a.I.pick(function(a){console.log("my Blob: "+JSON.stringify(a));b(a)},function(a){console.log("error "+JSON.stringify(a));c(a)})})};g.prototype.open=g.prototype.open;function k(a){this.element=a;this.b=a.getElementsByTagName("iframe")[0];this.height=this.width=1;window.addEventListener("resize",this.e.bind(this))}f("Stage",k);k.prototype.D=function(a,b){console.log("setSize",a,b);this.width=a;this.height=b;this.e()};k.prototype.setSize=k.prototype.D;
k.prototype.e=function(){this.b.style.width=this.width+"px";this.b.style.height=this.height+"px";var a={H:this.element.offsetWidth,s:this.element.offsetHeight};console.log("redraw",a,this.b);var b=Math.min(1,a.H/this.width,a.s/this.height);this.b.style.transform="scale("+b+")";this.b.style.transformOrigin="0 0";var c=(a.s-this.height*b)/2;this.b.style.left=(a.H-this.width*b)/2+"px";this.b.style.top=c+"px"};k.prototype.redraw=k.prototype.e;
k.prototype.F=function(a){var b=this;return new Promise(function(c,e){b.b.onload=function(){return c(b.b.contentDocument)};b.b.onerror=function(a){return e(a)};b.b.src=a})};k.prototype.setUrl=k.prototype.F;f("Device",{T:0,U:1,V:2,W:3,S:4});var l=[{name:"mobile",width:320,height:480},{name:"mobile-h",width:476,height:320},{name:"tablet",width:768,height:1024},{name:"tablet-h",width:1024,height:768},{name:"desktop",width:1280,height:800}];f("DeviceData",l);
function m(a){var b=this;this.element=a;this.u=this.element.querySelector(".move-element");this.element.querySelector(".open");this.P=this.element.querySelector(".save");this.selection=[];this.p=this.m=this.n=this.B=this.o=null;this.element.addEventListener("click",function(a){var e=a.target;e.classList.contains("open")&&b.o&&b.o();e.classList.contains("save")?(b.P.classList.toggle("off"),b.B&&b.B()):e.classList.contains("mobile")?b.f(0):e.classList.contains("mobile-h")?b.f(1):e.classList.contains("tablet")?
b.f(2):e.classList.contains("desktop")&&b.f(4);a.preventDefault();return!1});this.element.querySelector(".move-element .up").addEventListener("click",function(){b.n&&b.n()});this.element.querySelector(".move-element .down").addEventListener("click",function(){b.m&&b.m()})}f("Toolbar",m);
m.prototype.f=function(a){for(var b=this.element.querySelectorAll(".selected"),c=0;c<b.length;c++)b.item(c).classList.remove("selected");this.element.querySelector("."+l[a].name).classList.add("selected");this.p&&this.p(l[a].width,l[a].height)};m.prototype.setDevice=m.prototype.f;m.prototype.q=function(a){this.selection=a;this.e()};m.prototype.setSelection=m.prototype.q;m.prototype.e=function(){this.selection&&0<this.selection.length?this.u.classList.remove("disabled"):this.u.classList.add("disabled")};
m.prototype.redraw=m.prototype.e;function p(){this.k=this.j=this.l=!1;this.c=this.a=null;this.v=this.M.bind(this);this.A=this.O.bind(this);this.w=this.N.bind(this);this.h=null}f("Wysiwyg",p);p.prototype.R=function(a){return this.c=a};p.prototype.setOnSelect=p.prototype.R;p.prototype.L=function(){return this.c};p.prototype.getOnSelect=p.prototype.L;p.prototype.Q=function(a){return this.h=a};p.prototype.setOnBeforeSelect=p.prototype.Q;p.prototype.K=function(){return this.h};p.prototype.getOnBeforeSelect=p.prototype.K;
p.prototype.C=function(a){this.a&&(this.a.removeEventListener("mousedown",this.v),this.a.removeEventListener("mouseup",this.A),this.a.removeEventListener("mousemove",this.w));this.a=a;this.r(this.l);this.a.addEventListener("mouseup",this.A);this.a.addEventListener("mousedown",this.v);this.a.addEventListener("mousemove",this.w);this.j=!1;a=document.createElement("style");a.innerHTML="      .rsz-select-mode * {        min-width: 20px !important;        min-height: 20px !important;        opacity: 1 !important;        box-shadow: 0px 0px 2px rgba(51, 51, 51, 0.2);        cursor: pointer;      }      .rsz-dragging {      }      .rsz-selected {        box-shadow: 0 0 4px #333333;      }      .rsz-select-candidate {      }    ";
this.a.appendChild(a)};p.prototype.setContainer=p.prototype.C;p.prototype.r=function(a){this.l=a;this.a&&(a?this.a.classList.add("rsz-select-mode"):this.a.classList.remove("rsz-select-mode"))};p.prototype.setSelectionMode=p.prototype.r;p.prototype.i=function(a){for(var b=a;b&&this.h&&!this.h(b);)b=b.parentNode;return b||a};p.prototype.getBestElement=p.prototype.i;
function q(a,b){for(var c=null,e=a.parentNode.childNodes.length,h=0;h<e;h++){var n=a.parentNode.childNodes[h];!1===b&&(n=a.parentNode.childNodes[e-1-h]);if(1===n.nodeType){if(n===a)return c;c=n}}return null}p.prototype.O=function(a){r(this,this.i(a.target));a.preventDefault();return!1};p.prototype.M=function(a){this.i(a.target);this.j=!0;a.preventDefault();return!1};
p.prototype.N=function(a){var b=this.i(a.target);if(this.l)if(this.j)this.k||(this.k=!0);else{for(var c=this.a.querySelectorAll(".rsz-select-candidate"),e=0;e<c.length;e++)c[e].classList.remove("rsz-select-candidate");b.classList.add("rsz-select-candidate")}a.preventDefault();return!1};function r(a,b){a.j=!1;a.l&&(a.k?a.k=!1:(a.g().forEach(function(c){c!=b&&(c.classList.remove("rsz-selected"),a.c&&a.c())}),s(a,b)))}
p.prototype.g=function(){for(var a=[],b=this.a.querySelectorAll(".rsz-selected"),c=0;c<b.length;c++)a.push(b[c]);return a};p.prototype.getSelected=p.prototype.g;p.prototype.select=function(a){a.classList.add("rsz-selected");this.c&&this.c()};function s(a,b){b.classList.toggle("rsz-selected");a.c&&a.c()}function t(a){a.g().forEach(function(a){var c=q(a,!0);c&&a.parentNode.insertBefore(a,c)})}function u(a){a.g().forEach(function(a){var c=q(a,!1);c&&a.parentNode.insertBefore(c,a)})};function v(a){var b=this;this.toolbar=new m(a.querySelector("#toolbar"));this.G=new k(a.querySelector("#stage"));this.d=new p;this.J=new g;this.toolbar.p=function(a,e){return b.G.D(a,e)};this.toolbar.o=function(){return b.J.open().then(function(a){return w(b,a)})};this.toolbar.m=function(){return u(b.d)};this.toolbar.n=function(){return t(b.d)};this.d.h=function(a){return b.t(a)};this.d.c=function(){return b.toolbar.q(b.d.g())};this.d.r(!0);this.toolbar.f(4)}
v.prototype.t=function(a){var b=0,c;for(c in a.parentNode.childNodes)1===a.parentNode.childNodes[c].nodeType&&b++;return 1<b};f("App.prototype.hasSiblings",v.prototype.t);function w(a,b){a.G.F(b.url).then(function(b){a.d.C(b.body);a.toolbar.q([])})};window.initResponsizeApp=function(){new v(document.getElementById("rsz-app"))};
